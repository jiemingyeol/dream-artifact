<!DOCTYPE html>
<html lang="ko" 
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dream Artifact - Cart</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main-base.css') }}">
    {% set n = cart_products|length %}
    {% if n == 0 %}
        {% set frame_height = 1360 %}
    {% else %}
        {% set frame_height = 1360 + 204 + 248 * (n - 1) %}
    {% endif %}
    <style>
        @font-face {
            font-family: 'Geist';
            src: url('{{ url_for("static", filename="fonts/Geist-Regular.ttf") }}') format('truetype');
            font-weight: 400;
            font-style: normal;
        }
        @font-face {
            font-family: 'Geist';
            src: url('{{ url_for("static", filename="fonts/Geist-Medium.ttf") }}') format('truetype');
            font-weight: 500;
            font-style: normal;
        }
        @font-face {
            font-family: 'Geist';
            src: url('{{ url_for("static", filename="fonts/Geist-SemiBold.ttf") }}') format('truetype');
            font-weight: 600;
            font-style: normal;
        }
        @font-face {
            font-family: 'Tilt Warp';
            src: url('{{ url_for("static", filename="fonts/TiltWarp-Regular-VariableFont_XROT,YROT.ttf") }}') format('truetype');
            font-weight: 400;
            font-style: normal;
        }
        @font-face {
            font-family: 'Inter';
            src: url('{{ url_for("static", filename="fonts/Inter_24pt-Regular.ttf") }}') format('truetype');
            font-weight: 400;
            font-style: normal;
        }
        @font-face {
            font-family: 'Inter';
            src: url('{{ url_for("static", filename="fonts/Inter_24pt-SemiBold.ttf") }}') format('truetype');
            font-weight: 600;
            font-style: normal;
        }
        @font-face {
            font-family: 'Inter';
            src: url('{{ url_for("static", filename="fonts/Inter_24pt-Bold.ttf") }}') format('truetype');
            font-weight: 700;
            font-style: normal;
        }
    </style>
    <script src="{{ url_for('static', filename='js/main-base.js') }}"></script>
    <script src="{{ url_for('static', filename='js/image-preloader.js') }}"></script>
</head>
<body >
    <div class="main-container" id="cart-container" style="height: calc({{ frame_height }} / 1440 * var(--container-width));">
        <!-- Marquee -->
        <div class="w-full flex items-center justify-center relative bg-black" style="height: calc(53 / 1440 * var(--container-width));">
            <img src="{{ url_for('static', filename='images/main/marquee.png') }}" alt="Marquee" class="w-full h-full object-cover">
        </div>

        <!-- Logo -->
        <!-- 위치: (28, 70), 크기: 99×46 - intro와 동일한 위치 -->
        <div class="absolute cursor-pointer" style="left: calc(28 / 1440 * var(--container-width)); top: calc(60 / 1440 * var(--container-width)); width: calc(99 / 1440 * var(--container-width)); height: calc(46 / 1440 * var(--container-width)); z-index: 1000;" id="logoLink" data-intro1-url="{{ url_for('intro1') }}">
            <img src="{{ url_for('static', filename='images/main/logo.png') }}" alt="Logo" class="w-full h-full object-contain" style="display: block;">
        </div>

        <!-- Navigation -->
        <nav class="w-full flex items-center justify-between relative bg-black" style="height: calc(56 / 1440 * var(--container-width)); padding: 0 calc(28 / 1440 * var(--container-width));">
            <!-- Navigation Buttons -->
            <div class="flex items-center ml-auto" style="gap: calc(8 / 1440 * var(--container-width));">
                <button id="home-button" class="border-none transition-opacity hover:opacity-80 active:opacity-60 p-0 bg-transparent" style="height: calc(46 / 1440 * var(--container-width)); width: auto;">
                    <img src="{{ url_for('static', filename='images/main/home-button.png') }}" alt="Home" class="h-full w-auto object-contain" style="height: calc(46 / 1440 * var(--container-width)); width: auto;">
                </button>
                <button id="shop-button" class="border-none transition-opacity hover:opacity-80 active:opacity-60 p-0 bg-transparent" style="height: calc(46 / 1440 * var(--container-width)); width: auto;">
                    <img src="{{ url_for('static', filename='images/main/shop-button.png') }}" alt="Shop" class="h-full w-auto object-contain" style="height: calc(46 / 1440 * var(--container-width)); width: auto;">
                </button>
                <button id="cart-button" class="border-none p-0 bg-transparent relative" style="height: calc(46 / 1440 * var(--container-width)); width: auto; opacity: 0.5; pointer-events: none;">
                    <img src="{{ url_for('static', filename='images/main/cart-button.png') }}" alt="Cart" class="h-full w-auto object-contain" style="height: calc(46 / 1440 * var(--container-width)); width: auto;">
                    <!-- Cart Badge -->
                    <div class="absolute flex items-center justify-center rounded-full text-white" style="bottom: calc(33 / 1440 * var(--container-width)); left: calc(100% - 13 / 1440 * var(--container-width)); width: calc(20 / 1440 * var(--container-width)); height: calc(20 / 1440 * var(--container-width)); background-color: #FF3A3A; font-family: 'Geist', sans-serif; font-size: calc(12 / 1440 * var(--container-width)); font-weight: 600; line-height: 1.4; letter-spacing: calc(-0.02 * 12 / 1440 * var(--container-width));">
                        {{ cart_count }}
                    </div>
                </button>
            </div>
        </nav>
        
        <!-- Cart Title -->
        <div class="absolute" style="left: calc(51 / 1440 * var(--container-width)); top: calc(156 / 1440 * var(--container-width)); font-family: 'Tilt Warp', sans-serif; font-size: calc(160 / 1440 * var(--container-width)); font-weight: 400; line-height: 0.8; letter-spacing: calc(-0.05 * 160 / 1440 * var(--container-width)); color: #FFFFFF;">
            Cart
        </div>
        
        <!-- Text Count -->
        {% if n == 0 %}
            {% set text_count_y = 407 %}
        {% else %}
            {% set text_count_y = 407 + 204 + 248 * (n - 1) %}
        {% endif %}
        <div class="absolute text-count" style="left: calc(163 / 1440 * var(--container-width)); top: calc({{ text_count_y }} / 1440 * var(--container-width)); font-family: 'Geist', sans-serif; font-size: calc(20 / 1440 * var(--container-width)); font-weight: 400; line-height: 1.4; letter-spacing: 0; color: #FFFFFF;">
            총 주문 상품 {{ n }}개
        </div>
        
        <!-- Order Button -->
        {% if n == 0 %}
            {% set order_button_y = 514 %}
        {% else %}
            {% set order_button_y = 514 + 204 + 248 * (n - 1) %}
        {% endif %}
        <div class="absolute order-button cursor-pointer group" style="left: calc(1120 / 1440 * var(--container-width)); top: calc({{ order_button_y }} / 1440 * var(--container-width)); width: calc(134 / 1440 * var(--container-width)); height: calc(48 / 1440 * var(--container-width));">
            <img src="{{ url_for('static', filename='images/main/order-button.png') }}" alt="Order" class="w-full h-full object-contain absolute inset-0 transition-opacity duration-200 group-hover:opacity-0">
            <img src="{{ url_for('static', filename='images/main/order-button-hover.png') }}" alt="Order Hover" class="w-full h-full object-contain absolute inset-0 opacity-0 transition-opacity duration-200 group-hover:opacity-100">
        </div>
        <style>
            .cart-decrease-btn:hover:not([style*="pointer-events: none"]) {
                color: #C7C7C7 !important;
            }
            .cart-increase-btn:hover {
                color: #C7C7C7 !important;
            }
            .cart-delete-btn:hover {
                filter: brightness(1.3) saturate(1.1);
            }
            /* Loading Overlay */
            .loading-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: transparent;
                z-index: 10000;
                pointer-events: auto;
            }
            /* Loading Icon */
            .loading-icon {
                position: fixed;
                left: calc(702 / 1440 * var(--container-width));
                top: calc(254 / 1440 * var(--container-width));
                width: calc(94 / 1440 * var(--container-width));
                height: calc(94 / 1440 * var(--container-width));
                border-radius: 50%;
                background: conic-gradient(
                    from 0deg,
                    #FFAAFF 0deg 72deg,
                    #D9D9D9 72deg 360deg
                );
                mask: radial-gradient(circle, transparent calc(50% - 5.25px), black calc(50% - 5.25px));
                -webkit-mask: radial-gradient(circle, transparent calc(50% - 5.25px), black calc(50% - 5.25px));
                animation: spin 1s linear infinite;
                z-index: 10001;
                pointer-events: none;
            }
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
            /* 로딩 중 스크롤 방지 */
            body.loading-active {
                overflow: hidden;
                position: fixed;
                width: 100%;
                height: 100%;
            }
        </style>
        
        <!-- Token Rectangle -->
        {% if n == 0 %}
            {% set token_rect_y = 514 %}
        {% else %}
            {% set token_rect_y = 514 + 204 + 248 * (n - 1) %}
        {% endif %}
        <div class="absolute token-rectangle" style="left: calc(163 / 1440 * var(--container-width)); top: calc({{ token_rect_y }} / 1440 * var(--container-width)); width: calc(300 / 1440 * var(--container-width)); height: calc(61 / 1440 * var(--container-width)); background-color: #FFFFFF; border-radius: calc(159 / 1440 * var(--container-width)); z-index: 1;">
        </div>
        
        <!-- Text Token -->
        {% if n == 0 %}
            {% set text_token_y = 529 %}
        {% else %}
            {% set text_token_y = 529 + 204 + 248 * (n - 1) %}
        {% endif %}
        <div class="absolute text-token" style="left: calc(163 / 1440 * var(--container-width)); top: calc({{ text_token_y }} / 1440 * var(--container-width)); width: calc(300 / 1440 * var(--container-width)); font-family: 'Inter', sans-serif; font-size: calc(24 / 1440 * var(--container-width)); font-weight: 700; line-height: normal; letter-spacing: calc(-0.02 * 24 / 1440 * var(--container-width)); color: #000000; z-index: 10; text-align: center;">
            보유 토큰: <span style="color: #FFFFFF; opacity: 0;">원</span> {% if customer_token is defined %}{{ customer_token }}{% else %}0{% endif %}
        </div>
        <!-- Token Unit Image (보유토큰) -->
        <img src="{{ url_for('static', filename='images/main/token-unit-b.png') }}" alt="Token Unit" class="absolute" style="left: calc((163 + 150 - 12 + 3 + 24 * 0.15) / 1440 * var(--container-width)); top: calc(({{ text_token_y }} + 24 * 0.109) / 1440 * var(--container-width)); width: calc(24 / 1440 * var(--container-width)); height: auto; z-index: 11; pointer-events: none;">
        
        <!-- Text Total -->
        {% if n == 0 %}
            {% set text_total_y = 514 %}
        {% else %}
            {% set text_total_y = 514 + 204 + 248 * (n - 1) %}
        {% endif %}
        <div class="absolute text-total" style="left: calc(892 / 1440 * var(--container-width)); top: calc({{ text_total_y }} / 1440 * var(--container-width)); font-family: 'Inter', sans-serif; font-size: calc(40 / 1440 * var(--container-width)); font-weight: 700; line-height: normal; letter-spacing: calc(-0.02 * 40 / 1440 * var(--container-width)); color: #FFFFFF; z-index: 10; white-space: nowrap;">
            <span style="opacity: 0;">원</span> {% if total_price_formatted is defined %}{{ total_price_formatted }}{% else %}0{% endif %}
        </div>
        <!-- Token Unit Image (전체 가격) -->
        <img src="{{ url_for('static', filename='images/main/token-unit-w.png') }}" alt="Token Unit" class="absolute" style="left: calc((892 - 20 + 12) / 1440 * var(--container-width)); top: calc(({{ text_total_y }} + 40 * 0.14) / 1440 * var(--container-width)); width: calc(40 / 1440 * var(--container-width)); height: auto; z-index: 11; pointer-events: none;">
        
        <!-- Cart Items -->
        {% if cart_products %}
            {% for product in cart_products %}
                {% set item_y = 377.5 + 248 * loop.index0 %}
                <!-- 상품 컨테이너 배경 -->
                <div class="absolute cart-item" style="left: calc(157.5 / 1440 * var(--container-width)); top: calc({{ item_y }} / 1440 * var(--container-width)); width: calc(1104 / 1440 * var(--container-width)); height: calc(200 / 1440 * var(--container-width)); background-color: #000000; border: 1px solid #FFFFFF; border-radius: calc(15 / 1440 * var(--container-width)); z-index: 1;">
                </div>
                <!-- 상품 이미지: 전체 페이지 기준 (178, 398+248*n) -->
                {% set image_y = 398 + 248 * loop.index0 %}
                {% set image_url = product.image_path.replace('static/', '') %}
                <img src="{{ url_for('static', filename=image_url) }}" alt="{{ product.name }}" class="absolute product_image_{{ loop.index0 }}" style="left: calc(178 / 1440 * var(--container-width)); top: calc({{ image_y }} / 1440 * var(--container-width)); width: calc(162 / 1440 * var(--container-width)); height: calc(162 / 1440 * var(--container-width)); border-radius: calc(6 / 1440 * var(--container-width)); object-fit: cover; z-index: 2;">
                <!-- 상품 이름: 전체 페이지 기준 (379, 428+248*n) -->
                {% set name_y = 428 + 248 * loop.index0 %}
                <div class="absolute product_name_{{ loop.index0 }}" style="left: calc(379 / 1440 * var(--container-width)); top: calc({{ name_y }} / 1440 * var(--container-width)); font-family: 'Inter', sans-serif; font-size: calc(24 / 1440 * var(--container-width)); font-weight: 600; line-height: 1.2; letter-spacing: calc(-0.02 * 24 / 1440 * var(--container-width)); color: #FFFFFF; text-align: left; z-index: 2;">
                    {{ product.name }}
                </div>
                <!-- 상품 부제목: 전체 페이지 기준 (379, 488+248*n) -->
                {% set subtitle_y = 488 + 248 * loop.index0 %}
                <div class="absolute product_subtitle_{{ loop.index0 }}" style="left: calc(379 / 1440 * var(--container-width)); top: calc({{ subtitle_y }} / 1440 * var(--container-width)); font-family: 'Geist', sans-serif; font-size: calc(14 / 1440 * var(--container-width)); font-weight: 500; line-height: normal; letter-spacing: 0; color: #FFFFFF; text-align: left; z-index: 2;">
                    {{ product.subtitle }}
                </div>
                <!-- 수량 조절 버튼: 전체 페이지 기준 (796, 457+248*n) -->
                {% set button_y = 457 + 248 * loop.index0 %}
                <!-- "-" 버튼 -->
                <div class="absolute cart-decrease-btn cursor-pointer" data-product-id="{{ product.id }}" data-index="{{ loop.index0 }}" style="left: calc(796 / 1440 * var(--container-width)); top: calc({{ button_y }} / 1440 * var(--container-width)); font-family: 'Inter', sans-serif; font-size: calc(26 / 1440 * var(--container-width)); font-weight: 400; line-height: normal; letter-spacing: calc(-0.02 * 26 / 1440 * var(--container-width)); color: {% if product.count == 1 %}#C7C7C7{% else %}#FFFFFF{% endif %}; z-index: 2; transition: color 0.2s ease; {% if product.count == 1 %}pointer-events: none;{% endif %} padding: calc(10 / 1440 * var(--container-width)); margin: calc(-10 / 1440 * var(--container-width));">
                    -
                </div>
                <!-- 구매 개수: 전체 페이지 기준 (850, 457+248*n) -->
                <div class="absolute cart-count-display" data-index="{{ loop.index0 }}" style="left: calc(850 / 1440 * var(--container-width)); top: calc({{ button_y }} / 1440 * var(--container-width)); font-family: 'Inter', sans-serif; font-size: calc(26 / 1440 * var(--container-width)); font-weight: 400; line-height: normal; letter-spacing: calc(-0.02 * 26 / 1440 * var(--container-width)); color: #FFFFFF; z-index: 2;">
                    {{ product.count }}
                </div>
                <!-- "+" 버튼: 전체 페이지 기준 (905, 457+248*n) -->
                <div class="absolute cart-increase-btn cursor-pointer" data-product-id="{{ product.id }}" data-index="{{ loop.index0 }}" style="left: calc(905 / 1440 * var(--container-width)); top: calc({{ button_y }} / 1440 * var(--container-width)); font-family: 'Inter', sans-serif; font-size: calc(26 / 1440 * var(--container-width)); font-weight: 400; line-height: normal; letter-spacing: calc(-0.02 * 26 / 1440 * var(--container-width)); color: #FFFFFF; z-index: 2; transition: color 0.2s ease; padding: calc(10 / 1440 * var(--container-width)); margin: calc(-10 / 1440 * var(--container-width));">
                    +
                </div>
                <!-- 상품 가격: 전체 페이지 기준 (1017, 459+248*n) -->
                {% set price_y = 459 + 248 * loop.index0 %}
                <div class="absolute" style="left: calc(1017 / 1440 * var(--container-width)); top: calc({{ price_y }} / 1440 * var(--container-width)); font-family: 'Geist', sans-serif; font-size: calc(20 / 1440 * var(--container-width)); font-weight: 500; line-height: normal; letter-spacing: 0; color: #FFFFFF; z-index: 2;">
                    <span style="opacity: 0;">원</span> {{ product.total_price_formatted }}
                </div>
                <!-- Token Unit Image (상품 가격) -->
                <img src="{{ url_for('static', filename='images/main/token-unit-w.png') }}" alt="Token Unit" class="absolute" style="left: calc((1017 - 10 + 8.5) / 1440 * var(--container-width)); top: calc(({{ price_y }} + 20 * 0.18) / 1440 * var(--container-width)); width: calc(20 / 1440 * var(--container-width)); height: auto; z-index: 3; pointer-events: none;">
                <!-- 삭제 버튼: 전체 페이지 기준 (1174.5, 451.5+248*n) -->
                {% set trash_y = 451.5 + 248 * loop.index0 %}
                <img src="{{ url_for('static', filename='images/main/trash-button.png') }}" alt="Delete" class="absolute cart-delete-btn cursor-pointer" data-product-id="{{ product.id }}" data-index="{{ loop.index0 }}" style="left: calc(1174.5 / 1440 * var(--container-width)); top: calc({{ trash_y }} / 1440 * var(--container-width)); width: calc(45 / 1440 * var(--container-width)); height: calc(36 / 1440 * var(--container-width)); z-index: 2; transition: filter 0.2s ease;">
            {% endfor %}
        {% else %}
            <!-- 장바구니가 비어있을 때 -->
        {% endif %}
        
        <!-- Footer -->
        <div class="absolute left-0 w-full" style="bottom: calc(47 / 1440 * var(--container-width));">
            <img src="{{ url_for('static', filename='images/main/footer.png') }}" alt="Footer" class="w-full h-auto">
        </div>
    </div>
    <!-- 커스텀 커서 스크립트 -->
    <!-- Cart 데이터를 JavaScript 변수로 전달 -->
    <script>
        window.cartData = JSON.parse('{{ {"customerToken": (customer_token_value if customer_token_value is defined else 0), "totalPrice": (total_price if total_price is defined else 0), "cartCount": (cart_count if cart_count is defined else 0), "buyData": (buy_data if buy_data is defined else "")}|tojson|safe }}');
        window.receiptUrl = "{{ url_for('receipt') }}";
    </script>
    <!-- Navigation 버튼 클릭 이벤트 -->
    <script>
        (function() {
            // Home 버튼 클릭 시 home 페이지로 이동
            const homeButton = document.getElementById('home-button');
            if (homeButton) {
                homeButton.addEventListener('click', function() {
                    window.location.href = "{{ url_for('home') }}";
                });
            }
            
            // Shop 버튼 클릭 시 shop 페이지로 이동
            const shopButton = document.getElementById('shop-button');
            if (shopButton) {
                shopButton.addEventListener('click', function() {
                    window.location.href = "{{ url_for('shop') }}";
                });
            }
        })();
    </script>
    <!-- 커스텀 모달 스크립트 -->
    <script src="{{ url_for('static', filename='js/modal.js') }}"></script>
    <!-- 로고 클릭 시 초기 화면으로 돌아가기 -->
    <script src="{{ url_for('static', filename='js/intro-common.js') }}"></script>
    <!-- Cart 페이지 기능 스크립트 -->
    <script src="{{ url_for('static', filename='js/cart.js') }}"></script>
</body>
</html>
