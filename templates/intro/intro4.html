<!DOCTYPE html>
<html lang="ko" 
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dream Artifact - Intro 4</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/intro-base.css') }}">
    <style>
        @font-face {
            font-family: 'Geist';
            src: url('{{ url_for("static", filename="fonts/Geist-SemiBold.ttf") }}') format('truetype');
            font-weight: 600;
            font-style: normal;
        }
        @font-face {
            font-family: 'Geist';
            src: url('{{ url_for("static", filename="fonts/Geist-Medium.ttf") }}') format('truetype');
            font-weight: 500;
            font-style: normal;
        }
        /* 이름 입력 필드 스타일: 텍스트 색상 및 플레이스홀더 숨김 */
        #nameInput {
            color: #000000;
        }
        #nameInput::placeholder {
            color: transparent;
        }
        /* Next 버튼 폼 스타일: 버튼이 전체 영역을 차지하도록 */
        #nameForm button {
            display: block;
            width: 100%;
            height: 100%;
        }
    </style>
    <script src="{{ url_for('static', filename='js/image-preloader.js') }}"></script>
</head>
<body class="overflow-hidden h-screen w-screen flex items-center justify-center" >
    <div class="bg-desktop relative overflow-hidden" data-name="Desktop" data-node-id="1:8230">
        <!-- Marquee -->
        <div class="absolute top-0 left-0 w-full h-[7.41vh] flex items-center justify-center" data-name="Marquee" data-node-id="1:8231">
            <img src="{{ url_for('static', filename='images/intro/marquee.png') }}" alt="Marquee" class="w-full h-full object-cover">
        </div>

        <!-- Logo -->
        <!-- 위치: (28, 60), 크기: 99×46 -->
        <div class="absolute left-[1.94%] top-[7.41vh] w-[6.88%] h-[5.68vh] cursor-pointer" id="logoLink" data-intro1-url="{{ url_for('intro1') }}" data-name="로고 2" data-node-id="I1:8233;1:8388">
            <img src="{{ url_for('static', filename='images/intro/logo.png') }}" alt="Logo" class="w-full h-full object-cover max-w-none pointer-events-none">
        </div>

        <!-- Main Text -->
        <!-- Figma: 1440x810 프레임 기준, 크기 55.49%x13.46vh, 위치 left=6.25% top=calc(50%-7.41vh) -->
        <p class="absolute font-semibold h-[13.46vh] leading-[1.7] left-[6.25%] text-[1.67vw] text-white top-[calc(50%-7.41vh)] w-[55.49%]" style="font-family: 'Geist', sans-serif;" data-node-id="1:8311">
            이제, 당신의 이름을 알려주세요.
        </p>

        <!-- Name Input Box -->
        <!-- Figma: 1440x810 프레임 기준, 크기 26.11%x6.42vh, 위치 left=6.25% top=50.37vh, 최대 5자 입력 가능 -->
        <div class="absolute left-[6.25%] top-[50.37vh] w-[26.11%] h-[6.42vh]" data-node-id="13:1218">
            <div class="absolute inset-0 bg-white border-4 border-[#777] rounded-[17px] shadow-[0px_4px_4px_0px_rgba(0,0,0,0.25)]"></div>
            <input 
                type="text" 
                id="nameInput" 
                class="absolute inset-0 bg-transparent border-none outline-none px-[1.60vw] text-[1.11vw] text-black rounded-[17px]"
                style="font-family: 'Geist', sans-serif; font-weight: 500;"
                autocomplete="off"
            />
            <label 
                for="nameInput" 
                id="namePlaceholder" 
                class="absolute inset-0 flex items-center px-[1.60vw] text-[1.11vw] text-[#8b8b8b] pointer-events-none rounded-[17px]"
                style="font-family: 'Geist', sans-serif; font-weight: 500;"
            >
                이름을 입력해 주세요. (5자 이내)
            </label>
        </div>

        <!-- Pencil Illustration -->
        <!-- Figma: 1440x810 프레임 기준, 위치 top=3.70vh right=8.13% bottom=-2.84vh, 비율 1024:1536 -->
        <div class="absolute aspect-[1024/1536] bottom-[-2.84vh] right-[8.13%] top-[3.70vh] overflow-hidden" data-name="연필 모양 1" data-node-id="1:8313">
            <img src="{{ url_for('static', filename='images/intro/pencil-illustration.png') }}" alt="Pencil" class="absolute inset-0 w-full h-full object-cover max-w-none pointer-events-none">
        </div>

        <!-- Next Button -->
        <!-- Figma: 1440x810 프레임 기준, 크기 3.33%x5.93vh, 위치 bottom=4.81vh right=3.40% -->
        <form id="nameForm" action="{{ url_for('intro4_submit') }}" method="POST" class="absolute bottom-[4.81vh] right-[3.40%] w-[3.33%] h-[5.93vh] cursor-pointer transition-opacity hover:opacity-90 no-underline block" data-node-id="12:1217">
            <input type="hidden" id="nameValue" name="name" value="">
            <button type="submit" class="w-full h-full p-0 border-none bg-transparent cursor-pointer">
                <img src="{{ url_for('static', filename='images/intro/next-button.png') }}" alt="Next" class="block max-w-none w-full h-full pointer-events-none">
            </button>
        </form>
    </div>
    <!-- 커스텀 커서 스크립트 -->
    <!-- 로고 클릭 시 초기 화면으로 돌아가기 -->
    <script src="{{ url_for('static', filename='js/modal.js') }}"></script>
    <script src="{{ url_for('static', filename='js/intro-common.js') }}"></script>
    <!-- 이름 입력 필드 스크립트 -->
    <script>
        (function() {
            const nameInput = document.getElementById('nameInput');
            const namePlaceholder = document.getElementById('namePlaceholder');
            
            // 포커스 시 플레이스홀더 숨기기
            nameInput.addEventListener('focus', function() {
                namePlaceholder.style.display = 'none';
            });
            
            // 포커스 아웃 시 값이 없으면 플레이스홀더 표시
            nameInput.addEventListener('blur', function() {
                if (nameInput.value.trim() === '') {
                    namePlaceholder.style.display = 'flex';
                }
            });
            
            // 공백 포함 글자수 계산 함수
            function calcCharCount(text) {
                return text.length; // 공백 포함 전체 길이
            }
            
            // 5자 제한 함수
            function enforceMaxLength(text, maxLength) {
                const count = calcCharCount(text);
                if (count > maxLength) {
                    // 5자까지만 유지
                    return text.substring(0, maxLength);
                }
                return text;
            }
            
            // 입력 가능 여부 확인 함수
            function canInput(text, maxLength) {
                const count = calcCharCount(text);
                return count < maxLength;
            }
            
            // 입력 시 플레이스홀더 숨기기 및 5자 제한
            nameInput.addEventListener('input', function(e) {
                let text = nameInput.value;
                const maxLength = 5;
                
                // 5자 제한 적용
                if (!canInput(text, maxLength)) {
                    text = enforceMaxLength(text, maxLength);
                    nameInput.value = text;
                }
                
                // 플레이스홀더 숨기기
                if (text.trim() !== '') {
                    namePlaceholder.style.display = 'none';
                }
            });
            
            // 붙여넣기 시에도 5자 제한 적용
            nameInput.addEventListener('paste', function(e) {
                e.preventDefault();
                const pastedText = (e.clipboardData || window.clipboardData).getData('text');
                const currentValue = nameInput.value;
                const maxLength = 5;
                
                // 현재 글자수 확인
                const currentCount = calcCharCount(currentValue);
                const remaining = maxLength - currentCount;
                
                if (remaining > 0) {
                    // 붙여넣을 수 있는 만큼만 추가
                    const textToAdd = pastedText.substring(0, remaining);
                    nameInput.value = currentValue + textToAdd;
                }
                
                // 5자 제한 재확인
                nameInput.value = enforceMaxLength(nameInput.value, maxLength);
                
                // 플레이스홀더 숨기기
                if (nameInput.value.trim() !== '') {
                    namePlaceholder.style.display = 'none';
                }
            });
            
            // Next 버튼 클릭 시 이름을 form에 전달
            const nameForm = document.getElementById('nameForm');
            const nameValue = document.getElementById('nameValue');
            
            nameForm.addEventListener('submit', async function(e) {
                const name = nameInput.value.trim();
                
                // 이름이 없으면 제출 방지
                if (name === '') {
                    e.preventDefault();
                    await customAlert('이름을 입력해 주세요.');
                    nameInput.focus();
                    return false;
                }
                
                // 이름을 hidden input에 설정
                nameValue.value = name;
            });
        })();
    </script>
</body>
</html>
